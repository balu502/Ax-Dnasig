//
//  Назначение модуля DnaSig
//
////////////////////////////////////////////////

/*

1. Валидация подписи тестов
	.. может производиться как в режиме отдельного запуска исполняемого 
файла dnasig.exe, так и при вызове COM-интерфейса из других приложений. 
Пример ниже. В настройках программы должны быть указаны открытые ключи, по 
которым производится проверка подлинности электронной подписи интересующих 
тестов.

2. Подписывание тестов
	Подписывание тестов осуществляется при непосредственном запуске 
исполняемого файла dnasig.exe. В настройках программы должен быть указан 
приватный файл сертификата, которым будут подписываться тесты. После того,
как некоторый тест подписан, в теле описания этого теста появляется открытая
электронная подпись, по которой можно в дальнейшем установить подлинность
подписавшего лица. Порядок интерактивной работы с приложением для подписывания:
	- открыть файл(ы) тестов;
	- в списке появятся имена тестов и метка, указывающаяя текущую подпись;
	- выполнить подписывание (Sign), метка должна измениться;
	- сохранить список подписанных тестов (Save). 
	Cохраняется в файл именем exportTests.xml.
*/



//  Register in system
//
// dnasig.exe -regserver
//
////////////////////////////////////////////////


	if ( FAILED( CoInitialize( NULL ))){
	
      		qDebug() << "Unable to initialize COM";
		return -1;
	}

//....

	QAxObject axgp;

	// class dnasig
	//
	axgp.setControl( "{6DCA6D52-6D57-44ae-AFDC-2C4332680093}" );   


	if (axgp.control().isNull()){

        	qDebug() << "Unable to set COM control";
	        return -2;
	}


	// Check keys
	//
	qDebug() << axgp.dynamicCall( "publicKeys()");
	qDebug() << axgp.dynamicCall( "privateKeys()");


	QString xmlItem = "<item>........</item>";

	bool isValid = axgp.dynamicCall( "loadXmlTest(QString)", 
						xmlItem ).toBool();


//....
	CoUninitialize();
